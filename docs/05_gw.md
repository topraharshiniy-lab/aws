# Amazon API Gateway

API Gateway allows you to create RESTful and HTTP APIs without managing servers.  
It is one of the core building blocks of serverless architectures.

***

# ------------------------------------

# ğŸ§  **SECTION 1: API Gateway Core Concepts (Simple Explanation)**

## **1. API Types**

API Gateway provides two major API types:

### **HTTP API (cheapest, fastest, new)**

*   Simple routing
*   Cheaper
*   Lower latency
*   Great for Lambda and microservices

### **REST API (full-featured, older)**

*   More configurable
*   Advanced authorization
*   Usage plans
*   API keys
*   Request/response transformations
*   WAF integration
*   Caching

ğŸ’¡ **Recommendation:**  
Use **HTTP API** for most new builds unless you need advanced REST features.

***

## **2. Integrations**

API Gateway integrates with:

*   Lambda
*   AWS services (S3, DynamoDB, Step Functionsâ€¦)
*   VPC Links
*   HTTP endpoints

***

## **3. Stages**

A stage is a deployment environment:

*   dev
*   test
*   prod

Each stage has its own:

*   URL
*   variables
*   logging settings

***

## **4. Authentication Methods**

API Gateway supports:

*   **IAM auth**
*   **Lambda authorizer**
*   **Amazon Cognito**
*   **API keys**
*   **JWT auth**

***

## **5. Throttling & Quotas**

Protects your backend from overload.

Example:

*   100 requests per second
*   10,000 requests per day

***

## **6. CORS**

Allows your web app to call your API from a browser.  
Must be configured properly.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 2: Handsâ€‘On Exercise #1

Create a Simple HTTP API â†’ Lambda Integration\*\*

This is the foundation for every serverless backend.

***

## **Step 1 â€” Create Lambda Function**

Name:

    api-hello-handler

Node.js example:

```javascript
exports.handler = async (event) => {
  return {
    statusCode: 200,
    body: JSON.stringify({ message: "Hello from API Gateway + Lambda" })
  };
};
```

***

## **Step 2 â€” Create an HTTP API**

AWS Console â†’ API Gateway â†’  
**Create API â†’ Build (HTTP API)**

Choose:

    Add integration â†’ Lambda
    Lambda: api-hello-handler

***

## **Step 3 â€” Create a Route**

Route:

    GET /hello

Integration:

    Lambda â†’ api-hello-handler

***

## **Step 4 â€” Deploy**

Stage:

    dev

***

## **Step 5 â€” Test URL**

Your API URL will look like:

    https://asdfs123.execute-api.us-east-1.amazonaws.com/hello

Open in browser â†’ you will see:

    { "message": "Hello from API Gateway + Lambda" }

***

### ğŸ¯ **Outcome:**

You have built your first serverless API endpoint.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 3: Handsâ€‘On Exercise #2

Build a REST API for CRUD Using Lambda + DynamoDB\*\*

This connects all previous steps (S3 â†’ Lambda â†’ DynamoDB).

***

## **Step 1 â€” Create Lambda Function**

Name:

    orders-api-handler

Use this sample code:

### **Node.js Example**

```javascript
const AWS = require("aws-sdk");
const db = new AWS.DynamoDB.DocumentClient();

exports.handler = async (event) => {
    const method = event.requestContext.http.method;
    const body = event.body ? JSON.parse(event.body) : null;

    if (method === "POST") {
        await db.put({
            TableName: "Orders",
            Item: body
        }).promise();
        return { statusCode: 200, body: "Order created" };
    }

    if (method === "GET") {
        const customerId = event.queryStringParameters.customerId;
        const orderId = event.queryStringParameters.orderId;

        const item = await db.get({
            TableName: "Orders",
            Key: { customerId, orderId }
        }).promise();

        return { statusCode: 200, body: JSON.stringify(item.Item) };
    }

    return { statusCode: 400, body: "Unsupported method" };
};
```

***

## **Step 2 â€” Create HTTP API**

Routes:

    POST /orders
    GET /orders

Integration:

    Lambda â†’ orders-api-handler

***

## **Step 3 â€” Test POST**

Use Postman or curl:

```bash
curl -X POST https://your-api/orders \
  -H "Content-Type: application/json" \
  -d '{"customerId":"C101","orderId":"O1111","amount":200}'
```

***

## **Step 4 â€” Test GET**

```bash
https://your-api/orders?customerId=C101&orderId=O1111
```

***

### ğŸ¯ **Outcome:**

You now have a CRUD-capable REST API using API Gateway + Lambda + DynamoDB.

***

# ------------------------------------

# ğŸ§ª **SECTION 4: Enable CORS Properly**

Go to:

    API â†’ CORS â†’ Enable CORS

Allowed origins:

    *

In production:

    https://www.yourdomain.com

***

# ------------------------------------

# ğŸ§ª **SECTION 5: Add a Custom Domain (Route 53)**

You will need this for CloudFront later.

***

## **Step 1 â€” Request SSL Certificate**

ACM â†’ Request Certificate  
Domain:

    api.yourdomain.com

***

## **Step 2 â€” Configure Custom Domain**

API Gateway â†’ Custom Domain â†’ Add

Domain:

    api.yourdomain.com

Route mappings:

    / â†’ dev stage

***

## **Step 3 â€” Add DNS Record**

Route 53 â†’ Hosted Zone â†’ Create A record (alias â†’ API Gateway)

***

### ğŸ¯ **Outcome:**

Your API now runs at:

    https://api.yourdomain.com

***

# ------------------------------------

# ğŸ§ª **SECTION 6: Add Rate Limiting & Throttling**

API â†’ Stages â†’ dev â†’ Throttling

Set:

*   Burst limit: 50
*   Rate limit: 100 req/sec

***

### ğŸ¯ **Outcome:**

Your backend is protected from overload.

***

# ------------------------------------

# ğŸ§ª **SECTION 7: Add Authorization (3 Methods)**

## **1. IAM Authorization**

Use for internal APIs.

Example request:

```bash
aws lambda invoke --function-name test ...
```

***

## **2. Lambda Authorizer**

Custom auth logic.

Flow:

    Client â†’ API â†’ Authorizer Lambda â†’ API â†’ Handler Lambda

***

## **3. Cognito JWT Authorizer**

Use Cognito for login/signup flows.

***

# ------------------------------------

# ğŸ“˜ **SECTION 8: Use WAF With API Gateway**

You can protect your API using AWS WAF rules.

Steps:

1.  Go to WAF â†’ Create Web ACL
2.  Attach to API Gateway (REST APIs only)
3.  Add rules:
    *   SQL injection
    *   Rate-limit
    *   Bot Control
    *   IP allow/block lists

***

# ------------------------------------

# ğŸ” **SECTION 9: API Security Best Practices**

âœ” Use IAM or JWT authentication  
âœ” Turn on access logging  
âœ” Add throttling + rate limiting  
âœ” Protect with WAF  
âœ” Validate request body in Lambda  
âœ” Never fully trust user input  
âœ” Do not return raw DynamoDB errors

***

# ------------------------------------

# ğŸ“ **SECTION 10: Stepâ€‘5 Final Assignment (Mini Project)**

You will build the **final serverless API stage**:

### **Architecture**

    Route 53 â†’ API Gateway â†’ Lambda â†’ DynamoDB â†’ CloudWatch

***

## **Your tasks**

1ï¸âƒ£ Create HTTP API  
2ï¸âƒ£ Add Lambda integrations  
3ï¸âƒ£ Implement CRUD for Orders table  
4ï¸âƒ£ Add validation checks  
5ï¸âƒ£ Enable CORS  
6ï¸âƒ£ Add throttling  
7ï¸âƒ£ Create custom domain  
8ï¸âƒ£ Attach WAF  
9ï¸âƒ£ Log everything to CloudWatch

***