# Amazon CloudWatch

CloudWatch gives you visibility into:

*   Logs
*   Metrics
*   Alarms
*   Dashboards
*   Traces
*   Application performance (Lambda Insights, API Gateway logs, DynamoDB metrics)

***

# ğŸ§  **SECTION 1: CloudWatch Core Concepts (Simple Overview)**

## **1. CloudWatch Logs**

Logs generated by AWS services like:

*   Lambda output / console.log
*   API Gateway access logs
*   VPC flow logs
*   ECS/EKS logs
*   Custom logs you push

***

## **2. CloudWatch Metrics**

Numeric timeâ€‘series data such as:

*   Lambda duration
*   Lambda errors
*   API Gateway 4xx/5xx errors
*   DynamoDB read/write capacity
*   S3 bucket size
*   CPU of EC2

***

## **3. CloudWatch Alarms**

Notify you when a metric crosses a threshold:

*   Error spikes
*   High latency
*   Too many API Gateway 5xx errors
*   DynamoDB throttling
*   Lambda hitting timeouts

***

## **4. CloudWatch Dashboards**

Visual panels combining metrics, logs, and alarms for monitoring.

***

## **5. CloudWatch Log Insights**

A SQLâ€‘like query engine for real-time log analytics.

***

## **6. CloudWatch Events / EventBridge**

Modern version: **EventBridge**  
Used for:

*   Scheduled jobs
*   Automation
*   Event-driven workflows

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 2: Handsâ€‘On Exercise #1

Enable Lambda Logging and View Logs\*\*

This is the MOST COMMON CloudWatch scenario.

***

## **Step 1 â€” Create Lambda Function**

Use existing or create a new one:

    lambda-cloudwatch-demo

***

## **Step 2 â€” Write Sample Logging Code**

### Python

```python
def lambda_handler(event, context):
    print("This is a debug log!")
    print("Event received:", event)
    return {"message": "Lambda executed"}
```

### Node.js

```javascript
exports.handler = async (event) => {
  console.log("This is a debug log!");
  console.log("Event:", JSON.stringify(event));
  return { message: "Lambda executed" };
};
```

***

## **Step 3 â€” Run the Lambda**

Click **Test** â†’ Run.

***

## **Step 4 â€” View Logs**

CloudWatch â†’ Logs â†’ Log groups â†’

    /aws/lambda/lambda-cloudwatch-demo

Open the latest log stream â†’ you will see your `console.log` outputs.

***

### ğŸ¯ **Outcome:**

Youâ€™ve successfully viewed Lambda logs in CloudWatch.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 3: Handsâ€‘On Exercise #2

Use CloudWatch Log Insights to Query Logs\*\*

This is essential for debugging production issues.

***

## **Step 1 â€” Go to CloudWatch â†’ Logs Insights**

Select:

    /aws/lambda/lambda-cloudwatch-demo

***

## **Step 2 â€” Run Queries**

### **Query 1: Show recent logs**

```sql
fields @timestamp, @message
| sort @timestamp desc
| limit 20
```

### **Query 2: Find errors**

```sql
fields @message
| filter @message like /error/i
| limit 50
```

### **Query 3: Count invocations by minute**

```sql
stats count(*) by bin(1m)
```

***

### ğŸ¯ **Outcome:**

You can now search and analyze Lambda logs.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 4: Handsâ€‘On Exercise #3

Monitor Lambda Metrics (Errors, Duration, Invocations)\*\*

## **Step 1 â€” Open Metrics**

CloudWatch â†’ Metrics â†’ Lambda

Common metrics to inspect:

*   Invocations
*   Duration
*   Errors
*   Throttles
*   IteratorAge (streams)
*   ConcurrentExecutions

***

## **Step 2 â€” Create a Graph**

Select:

    Duration
    Errors
    Throttles

Add to a graph.

***

### ğŸ¯ **Outcome:**

You now know how to monitor Lambda performance directly.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 5: Handsâ€‘On Exercise #4

Set CloudWatch Alarm for Lambda Errors\*\*

Alarms notify you when something breaks.

***

## **Step 1 â€” Create Alarm**

CloudWatch â†’ Alarms â†’ Create alarm

Select metric:

    Lambda â†’ Errors
    Function: your-lambda

***

## **Step 2 â€” Define Threshold**

Example:

    If errors > 0 for 1 minute â†’ trigger alarm

***

## **Step 3 â€” Notifications (optional)**

Use SNS to send alerts to email:

*   <You@company.com>
*   On-call group
*   Slack (via webhook)

***

### ğŸ¯ **Outcome:**

You get notified when your Lambda fails.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 6: Handsâ€‘On Exercise #5

Enable API Gateway Access Logs\*\*

This is critical to debug endpoints.

***

## **Step 1 â€” Go to API Gateway â†’ Stages â†’ dev**

Enable:

    Access logging
    Execution logging

***

## **Step 2 â€” Select Log group**

Use:

    /aws/api-gateway/orders-api

***

## **Step 3 â€” Choose Log Format**

Example JSON:

    $context.identity.sourceIp $context.httpMethod $context.routeKey $context.status $context.requestId

***

## **Step 4 â€” View Logs in CloudWatch**

Navigate to the log group.

***

### ğŸ¯ **Outcome:**

You can now see all API calls, IPs, errors, and latency.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 7: Handsâ€‘On Exercise #6

Create a CloudWatch Dashboard\*\*

Dashboards help your team monitor production in real time.

***

## **Step 1 â€” Go to Dashboards â†’ Create dashboard**

Name:

    serverless-prod-dashboard

***

## **Step 2 â€” Add Widgets**

Add:

*   Lambda duration graph
*   Lambda errors graph
*   API Gateway 4xx/5xx errors
*   DynamoDB read/write throttles
*   CloudFront requests & cache hit rate (available in metrics)
*   WAF blocked requests

***

## **Step 3 â€” Save Dashboard**

***

### ğŸ¯ **Outcome:**

You now have a real observability dashboard.

***

# ------------------------------------

# ğŸ“˜ **SECTION 8: Scheduled Jobs (CloudWatch Events / EventBridge)**

Example: run Lambda every hour.

***

## **Step 1 â€” Go to EventBridge â†’ Create Rule**

Name:

    hourly-lambda-trigger

Pattern:

    Schedule
    Cron: 0 * * * ? *

***

## **Step 2 â€” Target**

    Lambda â†’ your-lambda

***

### ğŸ¯ **Outcome:**

Your Lambda runs every hour automatically.

***

# ------------------------------------

# ğŸ” **SECTION 9: CloudWatch Best Practices (Developerâ€‘Focused)**

âœ” Turn on Lambda Insights for performance details  
âœ” Enable structured logging (JSON logs are easier to filter)  
âœ” Always enable API Gateway execution & access logs  
âœ” Use log retention policies (donâ€™t store logs forever)  
âœ” Use alarms for:

*   Lambda errors
*   API Gateway 5xx
*   DynamoDB throttles  
    âœ” Create dashboards for prod monitoring  
    âœ” Use Log Insights for debugging

***

# ------------------------------------

# ğŸ“ **SECTION 10: Stepâ€‘6 Final Assignment (Mini Project)**

Build a production-level serverless monitoring setup.

***

## **Requirements**

1ï¸âƒ£ Enable Lambda logging  
2ï¸âƒ£ Enable API Gateway access + execution logs  
3ï¸âƒ£ Query logs using CloudWatch Log Insights  
4ï¸âƒ£ Create alarms for:
*   Lambda errors
*   API 5xx
*   DynamoDB throttles  
5ï¸âƒ£ Create CloudWatch Dashboard showing:
*   Lambda duration & errors
*   API latency
*   DynamoDB metrics
*   WAF blocked requests  
6ï¸âƒ£ Create scheduled EventBridge rule to run Lambda every hour

***