# Amazon CloudFront

Amazon CloudFront is AWSâ€™s global **Content Delivery Network (CDN)**. It accelerates delivery of:

*   static websites
*   APIs
*   backend services
*   images and video
*   single-page applications (React, Angular, Vue)
*   files from S3
*   dynamic content

CloudFront integrates closely with:

*   S3
*   API Gateway
*   Lambda\@Edge
*   CloudFront Functions
*   Route 53
*   WAF

***

# ------------------------------------

# ğŸ§  **SECTION 1: CloudFront Core Concepts (Simple Explanation)**

## **1. Distribution**

A CloudFront distribution is the CDN configuration.

It contains:

*   Origins (S3, API Gateway, ALB, custom HTTP backend)
*   Behaviors
*   Cache policies
*   Security settings
*   SSL certificates

***

## **2. Edge Locations**

These are global PoPs (points of presence).  
CloudFront caches your content at these edge locations.

***

## **3. Origins**

You can connect CloudFront to:

*   S3 buckets
*   API Gateway
*   Application Load Balancer
*   Any HTTPS endpoint

***

## **4. Behaviors**

Rules that decide:

*   which requests go to which origin
*   caching rules
*   security settings

Example:

    /api/* â†’ API Gateway
    /* â†’ S3 website

***

## **5. OAC â€” Origin Access Control (IMPORTANT)**

Modern secure method for allowing CloudFront to access private S3 buckets.

Replaces **Origin Access Identity (OAI)**.

***

## **6. Cache Policies**

Define what CloudFront stores and uses as the cache key.

Common built-in ones:

*   CachingOptimized
*   CachingDisabled
*   CachingOptimizedForUncompressedObjects

***

## **7. Viewer Protocol Policy**

Controls HTTP/HTTPS access:

*   **Redirect HTTP â†’ HTTPS**
*   **Allow both**
*   **HTTPS only**

Always use HTTPS in production.

***

## **8. Lambda\@Edge vs CloudFront Functions**

### **CloudFront Functions**

*   Super lightweight
*   Runs at viewer request/response
*   Good for URL rewrites, headers, redirects

### **Lambda\@Edge**

*   Heavier
*   Runs at viewer OR origin
*   Can modify request bodies
*   Good for auth, image manipulation, dynamic routing

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 2: Handsâ€‘On Exercise #1

Create CloudFront Distribution for S3 Static Site\*\*

### **Goal:**

Serve your website globally with caching and HTTPS.

***

## **Step 1 â€” Create S3 bucket for website**

Make sure:

*   Versioning enabled
*   Public access blocked
*   Bucket is **NOT** public

Upload:

*   index.html
*   error.html

***

## **Step 2 â€” Create CloudFront Distribution**

CloudFront â†’ Create Distribution â†’ **Web**

Origin:

    S3 bucket (your static site)

***

## **Step 3 â€” Set Viewer Protocol Policy**

    Redirect HTTP â†’ HTTPS

***

## **Step 4 â€” Configure Default Behavior**

*   Cache policy: `CachingOptimized`
*   Allowed methods: `GET, HEAD`
*   Compress objects: Enabled

***

## **Step 5 â€” Add Alternate Domain Name (CNAME)**

(optional)

    www.myapp.com

***

## **Step 6 â€” Add SSL Certificate**

Use ACM cert for your domain.

***

## **Step 7 â€” Deploy**

Takes \~10 minutes.

***

### ğŸ¯ **Outcome:**

Your S3 content is now delivered globally with HTTPS + caching.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 3: Handsâ€‘On Exercise #2

Secure S3 Using Origin Access Control (OAC)\*\*

This is the **modern, recommended** method for S3 â†’ CloudFront security.

***

## **Step 1 â€” Create OAC**

CloudFront â†’ Origin â†’ Create Origin Access Control

***

## **Step 2 â€” Attach OAC to Distribution**

***

## **Step 3 â€” Update S3 Bucket Policy**

Paste this (CloudFront gives you exact snippet):

```json
{
  "Effect": "Allow",
  "Principal": {
    "Service": "cloudfront.amazonaws.com"
  },
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::yourbucket/*",
  "Condition": {
    "StringEquals": {
      "AWS:SourceArn": "arn:aws:cloudfront::<account-id>:distribution/<distribution-id>"
    }
  }
}
```

***

### ğŸ¯ **Outcome:**

Your S3 bucket is private, and only CloudFront can access it.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 4: Handsâ€‘On Exercise #3

CloudFront + API Gateway (Backend API Caching)\*\*

### **Goal:**

Accelerate API requests globally.

***

## **Step 1 â€” Create CloudFront Distribution**

Origin:

    https://your-api-id.execute-api.us-east-1.amazonaws.com

***

## **Step 2 â€” Behavior**

Path pattern:

    /api/*

Cache policy:

    CachingDisabled

Why?  
APIs often must return fresh data.

***

## **Step 3 â€” Enable HTTPS**

Viewer protocol:

    Redirect HTTP â†’ HTTPS

***

## **Step 4 â€” Deploy**

***

### ğŸ¯ **Outcome:**

Your API Gateway endpoint is now global with lower latency.

***

# ------------------------------------

# ğŸ§ª \*\*SECTION 5: Handsâ€‘On Exercise #4

Add CloudFront Function for URL Rewrites\*\*

### Use Case:

Force all `/` requests to `index.html` for SPA routing.

***

## **Step 1 â€” Create Function**

Code:

```javascript
function handler(event) {
    var request = event.request;
    if (request.uri === "/" || request.uri.endsWith("/")) {
        request.uri = "/index.html";
    }
    return request;
}
```

***

## **Step 2 â€” Associate with Behavior**

Viewer Request â†’ your function

***

### ğŸ¯ **Outcome:**

Your single-page application handles browser refresh correctly.

***

# ------------------------------------

# ğŸ§° **SECTION 6: CloudFront Caching Rules (Important)**

Caching key includes:

*   Path
*   Query strings
*   Headers
*   Cookies

Examples:

### **Cache by Query String**

Good for:

*   `/products?id=123`

### **Ignore Query String**

Good for:

*   `/static/logo.png`
*   `/assets/*.js`

### **Cache Based on Headers**

Used for:

*   Localization
*   User-agent based variations

***

# ------------------------------------

# ğŸ” **SECTION 7: CloudFront Security Best Practices**

âœ” Use HTTPS only  
âœ” Use OAC for S3  
âœ” Block public access at S3 level  
âœ” Attach AWS WAF to CloudFront  
âœ” Turn on CloudFront Access Logs  
âœ” Use geoblocking if needed  
âœ” Use signed URLs / cookies for private content

***

# ------------------------------------

# ğŸ“ **SECTION 8: Stepâ€‘8 Final Assignment (Mini Project)**

Build a production-ready CloudFront + S3 + API Gateway + WAF setup.

***

## **Requirements**

1ï¸âƒ£ Create CloudFront distribution with 2 origins:

*   S3 website
*   API Gateway (backend API)

2ï¸âƒ£ Create 2 behaviors:

    /* â†’ S3
    /api/* â†’ API Gateway

3ï¸âƒ£ Add:

*   OAC for S3
*   HTTPS redirect
*   Custom domain via Route 53
*   SSL certificate via ACM

4ï¸âƒ£ Add CloudFront Function:

*   Rewrite `/` â†’ `/index.html`

5ï¸âƒ£ Attach AWS WAF with:

*   AWS Managed Rule Set
*   Rate limiting
*   IP blacklist

6ï¸âƒ£ Enable:

*   Access logging
*   CloudWatch metrics dashboard

***

## **Expected Final Architecture**

    Route 53
         â†“
    CloudFront (Global CDN)
       â”Œâ”€â”€â”€â”€â”€â”€â”€ Origin #1: S3 (Frontend)
       â””â”€â”€â”€â”€â”€â”€â”€ Origin #2: API Gateway (Backend)
                   â†“
                Lambda â†’ DynamoDB

***

### ğŸ¯ **End Result:**

You now understand CloudFront deeply enough to build **enterprise-grade, globally distributed, fully secured serverless systems**.

***